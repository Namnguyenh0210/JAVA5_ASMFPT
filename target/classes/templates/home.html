<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{fragments/layout :: head('Trang Ch·ªß')}"></th:block>
    <link rel="stylesheet" th:href="@{/css/home.css?v=20251003}">
</head>

<body>
<!-- Header -->
<th:block th:replace="~{fragments/layout :: header}"></th:block>

<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <div class="container">
            <div class="hero-text fade-in">
                <h1>üéä Ch√†o Xu√¢n <span th:text="${tetYear}">2026</span> üéä</h1>
                <p class="hero-subtitle">Mua s·∫Øm qu√† T·∫øt truy·ªÅn th·ªëng v·ªõi ∆∞u ƒë√£i ƒë·∫∑c bi·ªát</p>
                <div class="hero-buttons">
                    <a class="btn btn-primary btn-lg" href="/sanpham">
                        <i class="fas fa-shopping-bag"></i> Mua S·∫Øm Ngay
                    </a>
                    <a class="btn btn-secondary btn-lg" href="/gioithieu">
                        <i class="fas fa-info-circle"></i> T√¨m Hi·ªÉu Th√™m
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="hero-decoration">
        <div class="firework firework-1">üéÜ</div>
        <div class="firework firework-2">‚ú®</div>
        <div class="firework firework-3">üéä</div>
    </div>
</section>

<!-- Features Section -->
<section class="features">
    <div class="container">
        <h2 class="section-title text-center">T·∫°i Sao Ch·ªçn Ch√∫ng T√¥i?</h2>
        <div class="row">
            <div class="col-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3>Qu√† T·∫∑ng √ù Nghƒ©a</h3>
                    <p>C√°c s·∫£n ph·∫©m ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, mang √Ω nghƒ©a may m·∫Øn cho nƒÉm m·ªõi</p>
                </div>
            </div>
            <div class="col-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <h3>Giao H√†ng Nhanh</h3>
                    <p>Giao h√†ng t·∫≠n n∆°i trong 24h, ƒë·∫£m b·∫£o t∆∞∆°i ngon cho ng√†y T·∫øt</p>
                </div>
            </div>
            <div class="col-4">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <h3>Ch·∫•t L∆∞·ª£ng Cao</h3>
                    <p>Cam k·∫øt 100% ch·∫•t l∆∞·ª£ng, ho√†n ti·ªÅn n·∫øu kh√¥ng h√†i l√≤ng</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products Section -->
<section class="featured-products">
    <div class="container">
        <h2 class="section-title text-center">S·∫£n Ph·∫©m N·ªïi B·∫≠t</h2>

        <!-- Ki·ªÉm tra n·∫øu c√≥ s·∫£n ph·∫©m -->
        <div th:if="${sanPhamNoiBat != null and !sanPhamNoiBat.isEmpty()}" class="row">
            <div class="col-3" th:each="sp : ${sanPhamNoiBat}">
                <div class="product-card">
                    <a th:href="@{/sanpham/{id}(id=${sp.maSP})}" class="product-link">
                        <div class="product-image">
                            <img th:alt="${sp.tenSP}"
                                 th:src="${sp.hinhAnh != null && !sp.hinhAnh.isEmpty()} ? ${sp.hinhAnh} : 'https://picsum.photos/300/300?random=' + ${sp.maSP}"
                                 onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
                            <div class="product-badge" th:if="${sp.soLuong < 20}">Hot</div>
                        </div>
                        <div class="product-info">
                            <h4 th:text="${sp.tenSP}">T√™n s·∫£n ph·∫©m</h4>
                            <p class="product-price" th:text="${#numbers.formatDecimal(sp.gia, 0, 'POINT', 0, 'COMMA')} + 'ƒë'">0ƒë</p>
                        </div>
                    </a>
                    <div class="product-actions">
                        <button class="btn-add-to-cart" type="button"
                                th:data-product-id="${sp.maSP}"
                                th:data-product-name="${sp.tenSP}"
                                th:data-product-price="${sp.gia}"
                                th:data-product-image="${sp.hinhAnh}"
                                onclick="addToCart(this)">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="btn-text">Th√™m V√†o Gi·ªè H√†ng</span>
                            <span class="btn-success-text">‚úì ƒê√£ Th√™m</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Th√¥ng b√°o n·∫øu kh√¥ng c√≥ s·∫£n ph·∫©m -->
        <div th:if="${sanPhamNoiBat == null or sanPhamNoiBat.isEmpty()}" class="text-center">
            <p>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o. Vui l√≤ng import database tr∆∞·ªõc.</p>
        </div>

        <div class="text-center" style="margin-top: 2rem;">
            <a class="btn btn-primary btn-lg" href="/sanpham">
                <i class="fas fa-eye"></i> Xem T·∫•t C·∫£ S·∫£n Ph·∫©m
            </a>
        </div>
    </div>
</section>

<!-- Categories Section -->
<section class="categories" th:if="${danhMuc != null and !danhMuc.isEmpty()}">
    <div class="container">
        <h2 class="section-title text-center">Danh M·ª•c S·∫£n Ph·∫©m</h2>
        <div class="row">
            <div class="col-3" th:each="dm : ${danhMuc}">
                <a th:href="@{/sanpham(loai=${dm.maLoai})}" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <h3 th:text="${dm.tenLoai}">Danh m·ª•c</h3>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- News Section -->
<section class="news" th:if="${tinTuc != null and !tinTuc.isEmpty()}">
    <div class="container">
        <h2 class="section-title text-center">Tin T·ª©c & Ki·∫øn Th·ª©c</h2>
        <div class="row">
            <div class="col-4" th:each="bv : ${tinTuc}">
                <div class="news-card">
                    <a th:href="@{/kienthuc/{id}(id=${bv.maBV})}">
                        <div class="news-image">
                            <img th:alt="${bv.tieuDe}"
                                 th:src="${bv.hinhAnh != null && !bv.hinhAnh.isEmpty()} ? ${bv.hinhAnh} : 'https://picsum.photos/400/250?random=' + ${bv.maBV}"
                                 onerror="this.src='https://via.placeholder.com/400x250?text=No+Image'">
                        </div>
                        <div class="news-info">
                            <h4 th:text="${bv.tieuDe}">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h4>
                            <p class="news-date">
                                <i class="far fa-calendar"></i>
                                <span th:text="${#temporals.format(bv.ngayDang, 'dd/MM/yyyy')}">01/01/2025</span>
                            </p>
                            <p class="news-excerpt" th:text="${#strings.abbreviate(bv.noiDung, 100)}">N·ªôi dung t√≥m t·∫Øt...</p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <div class="text-center" style="margin-top: 2rem;">
            <a class="btn btn-secondary btn-lg" href="/kienthuc">
                <i class="fas fa-book"></i> Xem Th√™m B√†i Vi·∫øt
            </a>
        </div>
    </div>
</section>

<!-- Footer -->
<th:block th:replace="~{fragments/layout :: footer}"></th:block>

<!-- Scripts -->
<th:block th:replace="~{fragments/layout :: scripts}"></th:block>

<script>
    // Add to cart function - Kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p
    function addToCart(button) {
        const productId = button.dataset.productId;
        const productName = button.dataset.productName;
        const productPrice = button.dataset.productPrice;
        const productImage = button.dataset.productImage;

        // Disable button ƒë·ªÉ tr√°nh click nhi·ªÅu l·∫ßn
        if (button.classList.contains('adding') || button.classList.contains('added')) {
            return;
        }

        button.classList.add('adding');
        button.disabled = true;

        // L∆∞u v√†o localStorage (kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p)
        try {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]');

            // Ki·ªÉm tra s·∫£n ph·∫©m ƒë√£ c√≥ trong gi·ªè ch∆∞a
            const existingItemIndex = cart.findIndex(item => item.id === productId);

            if (existingItemIndex > -1) {
                // TƒÉng s·ªë l∆∞·ª£ng n·∫øu ƒë√£ c√≥
                cart[existingItemIndex].quantity += 1;
            } else {
                // Th√™m m·ªõi n·∫øu ch∆∞a c√≥
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    quantity: 1
                });
            }

            // L∆∞u l·∫°i v√†o localStorage
            localStorage.setItem('cart', JSON.stringify(cart));

            // Success animation
            button.classList.remove('adding');
            button.classList.add('added');

            // Update cart badge
            updateCartBadge();

            // Show notification CH·ªà M·ªòT L·∫¶N
            showNotification(`‚úì ƒê√£ th√™m "${productName}" v√†o gi·ªè h√†ng!`, 'success');

            // Reset button sau 2 gi√¢y
            setTimeout(() => {
                button.classList.remove('added');
                button.disabled = false;
            }, 2000);

        } catch (error) {
            console.error('Error:', error);
            button.classList.remove('adding');
            button.disabled = false;
            showNotification('‚ùå C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!', 'error');
        }
    }

    // Update cart badge
    function updateCartBadge() {
        const cart = JSON.parse(localStorage.getItem('cart') || '[]');
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        const badges = document.querySelectorAll('.cart-badge, .badge-cart, .cart-count');
        badges.forEach(badge => {
            badge.textContent = totalItems;
            badge.classList.add('pulse');
            setTimeout(() => badge.classList.remove('pulse'), 500);
        });
    }

    // Show notification function - CH·ªà HI·ªÇN TH·ªä NOTIFICATION
    function showNotification(message, type = 'success') {
        // Remove existing notifications
        const existingNotif = document.querySelector('.cart-notification');
        if (existingNotif) {
            existingNotif.remove();
        }

        // Create notification element
        const notification = document.createElement('div');
        notification.className = `cart-notification ${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <span class="notification-message">${message}</span>
                <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;

        document.body.appendChild(notification);

        // Animate in
        setTimeout(() => notification.classList.add('show'), 10);

        // Auto remove after 3 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Load cart badge on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateCartBadge();
    });
</script>

</body>

</html>