<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head(title)">
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title th:text="${title} + ' - T·∫øt Market'">T·∫øt Market</title>

    <!-- Common CSS with cache busting - use simple version number -->
    <link rel="stylesheet" th:href="@{/css/common.css?v=20251017}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Page specific CSS will be inserted here -->
    <th:block th:fragment="page-css"></th:block>

    <!-- Meta tags for SEO -->
    <meta content="Chuy√™n cung c·∫•p s·∫£n ph·∫©m T·∫øt truy·ªÅn th·ªëng ch·∫•t l∆∞·ª£ng cao" name="description">
    <meta content="qu√† t·∫øt, gi·ªè qu√† t·∫øt, h·ªôp qu√† t·∫øt, m·ª©t t·∫øt, b√°nh k·∫πo" name="keywords">
    <meta content="T·∫øt Market" name="author">

    <!-- Favicon -->
    <link rel="icon" th:href="@{/img/favicon.ico}" type="image/x-icon">

    <!-- Prevent CSS cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>

<body>
<!-- Header Fragment -->
<header class="header" th:fragment="header">
    <div class="container">
        <div class="header-content">
            <a class="logo" href="/">
                <img alt="Logo" onerror="this.style.display='none'" th:src="@{/img/logo-trang.png}">
                <span>üßß T·∫øt Market</span>
            </a>

            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>

            <nav class="nav" id="mainNav">
                <a class="nav-link" href="/" th:classappend="${currentPage == 'home' ? 'active' : ''}">
                    <i class="fas fa-home"></i> Trang Ch·ªß
                </a>
                <a class="nav-link" href="/sanpham" th:classappend="${currentPage == 'sanpham' ? 'active' : ''}">
                    <i class="fas fa-shopping-bag"></i> S·∫£n Ph·∫©m
                </a>
                <a class="nav-link" href="/gioithieu" th:classappend="${currentPage == 'gioithieu' ? 'active' : ''}">
                    <i class="fas fa-info-circle"></i> Gi·ªõi Thi·ªáu
                </a>
                <a class="nav-link" href="/kienthuc" th:classappend="${currentPage == 'kienthuc' ? 'active' : ''}">
                    <i class="fas fa-book"></i> Ki·∫øn Th·ª©c
                </a>
                <a class="nav-link" href="/lienhe" th:classappend="${currentPage == 'lienhe' ? 'active' : ''}">
                    <i class="fas fa-envelope"></i> Li√™n H·ªá
                </a>
                <a class="nav-link" href="/giohang" th:classappend="${currentPage == 'giohang' ? 'active' : ''}" style="position: relative;">
                    <i class="fas fa-shopping-cart"></i> Gi·ªè H√†ng
                    <span class="cart-count" id="cartCount" style="display: none;">0</span>
                </a>

                <!-- Hi·ªÉn th·ªã n√∫t ƒêƒÉng Nh·∫≠p khi ch∆∞a ƒëƒÉng nh·∫≠p -->
                <a sec:authorize="!isAuthenticated()" class="nav-link" href="/login" th:classappend="${currentPage == 'login' ? 'active' : ''}" style="background: rgba(251, 191, 36, 0.2); border: 1px solid var(--primary-gold);">
                    <i class="fas fa-sign-in-alt"></i> ƒêƒÉng Nh·∫≠p
                </a>

                <!-- Hi·ªÉn th·ªã Avatar v√† Dropdown khi ƒë√£ ƒëƒÉng nh·∫≠p -->
                <div sec:authorize="isAuthenticated()" class="user-menu">
                    <div class="user-avatar" onclick="toggleUserDropdown()">
                        <img th:src="'https://ui-avatars.com/api/?name=' + ${#authentication.name} + '&background=fbbf24&color=991b1b&bold=true&size=40'"
                             alt="Avatar" class="avatar-img">
                        <span class="user-name" sec:authentication="name">User</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-header">
                            <strong sec:authentication="name">user@example.com</strong>
                            <small sec:authorize="hasRole('ADMIN')">Qu·∫£n tr·ªã vi√™n</small>
                            <small sec:authorize="hasRole('STAFF')">Nh√¢n vi√™n</small>
                            <small sec:authorize="hasRole('USER')">Kh√°ch h√†ng</small>
                        </div>
                        <a href="/profile" class="dropdown-item">
                            <i class="fas fa-user-circle"></i> Th√¥ng tin c√° nh√¢n
                        </a>
                        <a href="/profile#orders" class="dropdown-item">
                            <i class="fas fa-box"></i> ƒê∆°n h√†ng c·ªßa t√¥i
                        </a>
                        <a href="/profile#addresses" class="dropdown-item">
                            <i class="fas fa-map-marker-alt"></i> ƒê·ªãa ch·ªâ giao h√†ng
                        </a>
                        <a href="/profile#password" class="dropdown-item">
                            <i class="fas fa-key"></i> ƒê·ªïi m·∫≠t kh·∫©u
                        </a>
                        <hr class="dropdown-divider">
                        <a sec:authorize="hasAnyRole('ADMIN', 'STAFF')" href="/admin" class="dropdown-item">
                            <i class="fas fa-cog"></i> Qu·∫£n tr·ªã h·ªá th·ªëng
                        </a>
                        <hr sec:authorize="hasAnyRole('ADMIN', 'STAFF')" class="dropdown-divider">
                        <a href="/logout" class="dropdown-item logout">
                            <i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</header>

<!-- Breadcrumb Fragment -->
<nav class="breadcrumb" th:fragment="breadcrumb(items)" th:if="${items != null and !items.isEmpty()}">
    <div class="container">
        <ol class="breadcrumb-list">
            <li th:class="${iterStat.last} ? 'breadcrumb-item active' : 'breadcrumb-item'"
                th:each="item, iterStat : ${items}">
                <a class="breadcrumb-link" th:href="${item.url}" th:if="${!iterStat.last}"
                   th:text="${item.name}">Home</a>
                <span th:if="${iterStat.last}" th:text="${item.name}">Current</span>
            </li>
        </ol>
    </div>
</nav>

<!-- Footer Fragment -->
<footer class="footer" th:fragment="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>üßß T·∫øt Market</h3>
                <p>Chuy√™n cung c·∫•p c√°c s·∫£n ph·∫©m T·∫øt truy·ªÅn th·ªëng ch·∫•t l∆∞·ª£ng cao, mang l·∫°i may m·∫Øn v√† th·ªãnh v∆∞·ª£ng cho gia
                    ƒë√¨nh b·∫°n.</p>
                <div class="social-links">
                    <a aria-label="Facebook" href="#"><i class="fab fa-facebook"></i></a>
                    <a aria-label="Instagram" href="#"><i class="fab fa-instagram"></i></a>
                    <a aria-label="YouTube" href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Li√™n K·∫øt Nhanh</h3>
                <a href="/">Trang Ch·ªß</a>
                <a href="/sanpham">S·∫£n Ph·∫©m</a>
                <a href="/gioithieu">Gi·ªõi Thi·ªáu</a>
                <a href="/lienhe">Li√™n H·ªá</a>
            </div>
            <div class="footer-section">
                <h3>Danh M·ª•c</h3>
                <a href="/sanpham?category=gio-qua">Gi·ªè Qu√† T·∫øt</a>
                <a href="/sanpham?category=hop-qua">H·ªôp Qu√† T·∫øt</a>
                <a href="/sanpham?category=mut-banh">M·ª©t - B√°nh K·∫πo</a>
                <a href="/sanpham?category=trang-tri">Trang Tr√≠</a>
            </div>
            <div class="footer-section">
                <h3>Li√™n H·ªá</h3>
                <p><i class="fas fa-map-marker-alt"></i> 123 ƒê∆∞·ªùng ABC, TP.HCM</p>
                <p><i class="fas fa-phone"></i> 0909.123.456</p>
                <p><i class="fas fa-envelope"></i> info@tetmarket.com</p>
                <p><i class="fas fa-clock"></i> 8:00 - 22:00 h√†ng ng√†y</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; <span th:text="${currentYear}">2025</span> T·∫øt Market. M·ª´ng nƒÉm <span
                    th:text="${tetYear}">2025</span>! üßß</p>
        </div>
    </div>
</footer>

<!-- Common Scripts Fragment -->
<div th:fragment="scripts">
    <script th:src="@{/js/common.js?v=20251017}"></script>
    <script th:src="@{/js/main.js?v=20251017}"></script>
</div>
</body>
</html>
